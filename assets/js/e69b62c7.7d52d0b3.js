"use strict";(self.webpackChunkcortexjs_io=self.webpackChunkcortexjs_io||[]).push([[9253],{5542:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"mathfield/security","title":"Security","description":"Content Security Policy","source":"@site/docs/mathfield/22-security.md","sourceDirName":"mathfield","slug":"/compute-engine/guides/security/","permalink":"/compute-engine/guides/security/","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1738881018000,"sidebarPosition":22,"frontMatter":{"title":"Security","slug":"/compute-engine/guides/security/"},"sidebar":"docSidebar","previous":{"title":"Web Component Lifecycle","permalink":"/mathfield/lifecycle/"},"next":{"title":"API Reference","permalink":"/mathfield/api/"}}');var s=n(4848),r=n(8453);const o={title:"Security",slug:"/compute-engine/guides/security/"},a=void 0,c={},d=[{value:"Content Security Policy",id:"content-security-policy",level:2},{value:"Trusted Types",id:"trusted-types",level:2},{value:"Restricting Commands That Modify the DOM",id:"restricting-commands-that-modify-the-dom",level:2},{value:"Disabling Commands",id:"disabling-commands",level:3}];function l(e){const t={a:"a",code:"code","code-playground":"code-playground",div:"div",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components},n=t["code-playground"];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h2,{id:"content-security-policy",children:"Content Security Policy"}),"\n",(0,s.jsx)(t.p,{children:"In order to interactively display mathfields, some CSS attributes are generated\ndynamically."}),"\n",(0,s.jsxs)(t.p,{children:["A ",(0,s.jsx)(t.strong,{children:"Content Security Policy (CSP)"})," is a security standard that helps prevent\nCross-Site Scripting (XSS) attacks. It works by defining a whitelist of trusted\nsources of content, and instructing the browser to only execute or render resources\nfrom those sources."]}),"\n",(0,s.jsx)(t.p,{children:"The server sends a CSP header to the browser, which then enforces the policy."}),"\n",(0,s.jsx)(t.p,{children:"If you are using a Content Security Policy, you may need to adjust\nit to allow the use of inline styles."}),"\n",(0,s.jsxs)(t.p,{children:["Specifically, you may need to add ",(0,s.jsx)(t.code,{children:"'unsafe-inline'"})," to the ",(0,s.jsx)(t.code,{children:"style-src"}),"\ndirective in the CSP header sent from your server."]}),"\n",(0,s.jsx)(t.p,{children:"Without it, the mathfield may not be displayed correctly."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-html",children:"<meta \n  http-equiv=\"Content-Security-Policy\" \n  content=\"style-src 'self' 'unsafe-inline';\"\n>\n"})}),"\n",(0,s.jsx)(t.h2,{id:"trusted-types",children:"Trusted Types"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Untrusted input"})," is input that is not under your control. For example, user input\nor data from a third-party API. In some cases, attempting to render untrusted\ninput can lead to a Cross-Site Scripting (XSS) attack. These attacks occur when\nan attacker injects malicious code into a web page, which is then executed by the\nbrowser. This code can steal sensitive information, such as cookies or session\ntokens, or perform actions on behalf of the user."]}),"\n",(0,s.jsxs)(t.p,{children:["If you are handling untrusted input, you should consider using\nthe ",(0,s.jsx)(t.code,{children:"MathfieldElement.createHTML()"})," static method to sanitize content. The\n",(0,s.jsx)(t.code,{children:"createHTML()"})," method follows the recommendations from the\n",(0,s.jsx)(t.a,{href:"https://www.w3.org/TR/trusted-types/",children:"Trusted Type"})," specification."]}),"\n",(0,s.jsx)(t.p,{children:"For example, using the DOMPurify library (there are other HTML sanitizers\navailable), will prevent potentially harmful content from being rendered."}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsxs)(t.div,{slot:"html",children:["<script\n","  ",'type="text/javascript"\n',"  ",'src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.2.3/purify.min.js">\n',"<\/script>\n","\n",'<math-field id="mf"></math-field>\n',"\n"]}),(0,s.jsxs)(t.div,{slot:"javascript",children:["function whenAvailable(name, fn) {\n","  ","setTimeout(() => {\n","    ","if (window[name]) fn();\n","    ","else whenAvailable(name, fn);\n","  ","}, 16);\n","}\n","\n",'whenAvailable("DOMPurify", () => {\n',"  ","MathfieldElement.createHTML = (html) => DOMPurify.sanitize(html);\n","  ","document.getElementById('mf').value = '\\\\htmlData{><img/onerror=alert(1)\"src=}{}'\n","});\n"]})]}),"\n",(0,s.jsxs)(t.p,{children:["(Note that this example is moot, as the ",(0,s.jsx)(t.code,{children:"htmlData"})," command already sanitizes its input.)"]}),"\n",(0,s.jsx)(t.h2,{id:"restricting-commands-that-modify-the-dom",children:"Restricting Commands That Modify the DOM"}),"\n",(0,s.jsxs)(t.p,{children:["Some commands modify the DOM and pose a higher risk of XSS attacks. For instance, ",(0,s.jsx)(t.code,{children:"\\htmlData{}{}"})," and ",(0,s.jsx)(t.code,{children:"\\href{}{}"})," allow the insertion of HTML attributes. While both commands sanitize their input to prevent harmful attributes, you may want to disable them for added security."]}),"\n",(0,s.jsx)(t.h3,{id:"disabling-commands",children:"Disabling Commands"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"To disable specific commands"}),", redefine them as no-ops."]}),"\n",(0,s.jsx)(t.p,{children:"For example, to disable \\htmlData and \\href:"}),"\n",(0,s.jsxs)(n,{children:[(0,s.jsxs)(t.div,{slot:"html",children:['<math-field id="mf">\\htmlData{foo=bar}{x+1}</math-field>\n',"\n"]}),(0,s.jsxs)(t.div,{slot:"javascript",children:["const mf = document.getElementById('mf');\n","mf.macros = {\n","  ","...mf.macros,\n","  ",'htmlData: { args: 2, def: "#2" },\n',"  ",'href: { args: 2, def: "#2" },\n',"};\n","\n"]})]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var i=n(6540);const s={},r=i.createContext(s);function o(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(r.Provider,{value:t},e.children)}}}]);