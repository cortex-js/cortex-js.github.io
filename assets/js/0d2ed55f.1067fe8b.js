"use strict";(self.webpackChunkcortexjs_io=self.webpackChunkcortexjs_io||[]).push([[4472],{185:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"mathfield/lifecycle","title":"Web Component Lifecycle","description":"A mathfield web component goes through various stages during its lifecycle.","source":"@site/docs/mathfield/21-lifecycle.md","sourceDirName":"mathfield","slug":"/mathfield/lifecycle/","permalink":"/mathfield/lifecycle/","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1731785970000,"sidebarPosition":21,"frontMatter":{"layout":"single","date":"Last Modified","slug":"/mathfield/lifecycle/","toc":true},"sidebar":"docSidebar","previous":{"title":"Static Math Formulas","permalink":"/mathfield/guides/static/"},"next":{"title":"Security","permalink":"/compute-engine/guides/security/"}}');var o=n(4848),s=n(8453);const a={layout:"single",date:"Last Modified",slug:"/mathfield/lifecycle/",toc:!0},l="Web Component Lifecycle",r={},d=[{value:"\u2460 Before Initialization",id:"-before-initialization",level:2},{value:"\u2461 Initialization",id:"-initialization",level:2},{value:"\u2462 Constructed",id:"-constructed",level:2},{value:"\u2463 Attached/Mounted",id:"-attachedmounted",level:2},{value:"\u2464 Detached/Unmounted",id:"-detachedunmounted",level:2}];function c(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components},{Intro:n,ReadMore:i}=t;return n||m("Intro",!0),i||m("ReadMore",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"web-component-lifecycle",children:"Web Component Lifecycle"})}),"\n",(0,o.jsx)(n,{children:(0,o.jsx)(t.p,{children:"A mathfield web component goes through various stages during its lifecycle.\nUnderstanding these stages can help you write more robust code."})}),"\n",(0,o.jsx)(t.p,{children:"In most cases, this is something you don't have to pay much attention to. Just\nremember these guidelines:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Once a component is attached to the DOM, attributes (key/value pairs\nattached to the ",(0,o.jsx)(t.code,{children:"<math-field>"})," tag and properties (key/value pairs attached\nto a ",(0,o.jsx)(t.code,{children:"MathfieldElement"})," object) are kept in sync, or ",(0,o.jsx)(t.em,{children:"reflected"}),", except for\nthe ",(0,o.jsx)(t.code,{children:"value"})," attribute which only reflect the inital value, not the current one.\nYou can also call the functions of ",(0,o.jsx)(t.code,{children:"MathfieldElement"})," without limitations."]}),"\n",(0,o.jsxs)(t.li,{children:["To be notified when the component is attached to the DOM, listen for a ",(0,o.jsx)(t.code,{children:"mount"}),"\nevent on the element."]}),"\n",(0,o.jsxs)(t.li,{children:["Before the component is attached to the DOM or even before the ",(0,o.jsx)(t.code,{children:"MathfieldElement"}),"\nclass has been registered, you can interact with the element, but with\nsome limitations. The ",(0,o.jsx)(t.code,{children:"value"}),", ",(0,o.jsx)(t.code,{children:"selection"}),", ",(0,o.jsx)(t.code,{children:"options"}),", ",(0,o.jsx)(t.code,{children:"disabled"})," properties\nand the properties matching an attribute (",(0,o.jsx)(t.code,{children:"readOnly"})," for ",(0,o.jsx)(t.code,{children:"read-only"}),", etc...)\nand related attributes are safe to set, but the values you read back may be\ndifferent once the component is mounted."]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"-before-initialization",children:"\u2460 Before Initialization"}),"\n",(0,o.jsxs)(t.p,{children:["When the page is loaded, before any code is loaded or executed, elements with a\n",(0,o.jsx)(t.code,{children:"<math-field>"})," tag will be laid out and rendered by the browser as if they were\na ",(0,o.jsx)(t.code,{children:"<div>"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["To prevent this from happening, you can use the ",(0,o.jsx)(t.code,{children:"not(:defined)"})," CSS\nselector and set the ",(0,o.jsx)(t.code,{children:"display"})," CSS property to ",(0,o.jsx)(t.code,{children:"none"}),". This will prevent\nsome potentially undesirable flash of content when the page is loaded."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-css",children:"math-field:not(:defined) {\n  display: none;\n}\n"})}),"\n",(0,o.jsx)(t.p,{children:"You can take some additional steps to ensure an optimal loading experience\nwith minimal layout shifts."}),"\n",(0,o.jsxs)(i,{path:"/mathfield/guides/integration/#optimizing-load-performance",children:["Read more about ",(0,o.jsx)("strong",{children:"Optimizing Load Performance"})]}),"\n",(0,o.jsx)(t.h2,{id:"-initialization",children:"\u2461 Initialization"}),"\n",(0,o.jsxs)(t.p,{children:["The element has been created from markup, but the code registering\nthe ",(0,o.jsx)(t.code,{children:"<math-field>"})," tag with the ",(0,o.jsx)(t.code,{children:"MathfieldElement"})," class has not been executed\nyet. This could happen if the scripts are loaded in an unexpected order or\nif there is a temporary networking issue."]}),"\n",(0,o.jsx)(t.p,{children:"At this stage:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["you can read and change the ",(0,o.jsx)(t.code,{children:"disabled"}),", ",(0,o.jsx)(t.code,{children:"value"}),", ",(0,o.jsx)(t.code,{children:"options"}),", ",(0,o.jsx)(t.code,{children:"selection"})," and\n",(0,o.jsx)(t.code,{children:"position"})," properties on the element."]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"document.querySelector('math-field').value = '\\\\sin x';\n"})}),"\n",(0,o.jsx)(t.p,{children:"However, some of those properties behave in a limited way."}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["you can change/add/remove attributes on the element. At this stage, the\nattributes and the properties are independent, so if you set for example the\n",(0,o.jsx)(t.code,{children:"math-virtual-keyboard-policy"})," attribute, it will not be reflected in\n",(0,o.jsx)(t.code,{children:"mf.mathVirtualKeyboardPolicy"}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["the only methods on the element that can be invoked are those of ",(0,o.jsx)(t.code,{children:"HTMLElement"}),"\nsince the element has not been upgraded yet."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.strong,{children:"To be notified when the registration takes place"}),", use ",(0,o.jsx)(t.code,{children:"customElements.whenDefined()"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["You may want to wait for this to access and modify some global properties\nof ",(0,o.jsx)(t.code,{children:"MathfieldElement"})]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"customElements.whenDefined('math-field').then(() => {\n  MathfieldElement.fontsDirectory = \"assets/fonts/\";  \n});\n"})}),"\n",(0,o.jsx)(t.p,{children:"If all goes well, the element will be constructed next."}),"\n",(0,o.jsx)(t.h2,{id:"-constructed",children:"\u2462 Constructed"}),"\n",(0,o.jsxs)(t.p,{children:["This stage occurs either after the previous one (i.e. an element created\nfrom markup) or when an element is created programmatically with ",(0,o.jsx)(t.code,{children:"new MathfieldElement()"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"HTMLElement"})," object exist, but it is not yet attached to the DOM. You can\ninteract with the element, but its operations are still limited."]}),"\n",(0,o.jsx)(t.p,{children:"At this stage:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["you can read and change the properties as before. However, doing so will\nbe reflected on attributes as well. That is calling ",(0,o.jsx)(t.code,{children:'mf.mathVirtualKeyboardPolicy = "manual"'}),"\nwill result in ",(0,o.jsx)(t.code,{children:"mf.getAttribute('math-virtual-keyboard-policy')"})," to return ",(0,o.jsx)(t.code,{children:'"manual"'}),"."]}),"\n",(0,o.jsxs)(t.li,{children:["you can read and change the attributes as before, however they will now\nbe reflected on properties as well, that is calling ",(0,o.jsx)(t.code,{children:"mf.setAttribute('math-virtual-keyboard-policy', 'manual')"}),"\nwill result in the value of ",(0,o.jsx)(t.code,{children:"mf.mathVirtualKeyboardPolicy"})," to be ",(0,o.jsx)(t.code,{children:'"manual"'}),"."]}),"\n",(0,o.jsx)(t.li,{children:"you can change/add/remove attributes on the element"}),"\n",(0,o.jsxs)(t.li,{children:["you can invoke all methods specific to ",(0,o.jsx)(t.code,{children:"MathfieldElement"}),", however some may\nhave some limitations. For example ",(0,o.jsx)(t.code,{children:"setValue()"})," will ignore any options provided\nincluding formats other than LaTeX, ",(0,o.jsx)(t.code,{children:"executeCommand()"})," will do anything, etc...\nThese commands require the element to be attached to the DOM to function properly.\nBut no worries, that's what happens next."]}),"\n"]}),"\n",(0,o.jsx)(t.h2,{id:"-attachedmounted",children:"\u2463 Attached/Mounted"}),"\n",(0,o.jsx)(t.p,{children:"This stage normally occurs after the element has been constructed."}),"\n",(0,o.jsxs)(t.p,{children:["The transition to this stage happens automatically for elements created from\nmarkup after the ",(0,o.jsx)(t.code,{children:"MathfieldElement"})," class has been registered to handle the\n",(0,o.jsx)(t.code,{children:"<math-field>"})," tag."]}),"\n",(0,o.jsxs)(t.p,{children:["If the element was created programatically, this stage is reached when the\nelement is explicitly attached to the DOM, for example using ",(0,o.jsx)(t.code,{children:"appendChild()"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"At this stage:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"you can read and change properties and attributes and they will reflect\neach other (changing an attribute will update the corresponding property and\nvice versa)."}),"\n",(0,o.jsxs)(t.li,{children:["you can invoke all functions of ",(0,o.jsx)(t.code,{children:"MathfieldElement"})," without limitations"]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.strong,{children:"To be notified when this stage is reached"}),", listen for the ",(0,o.jsx)(t.code,{children:"mount"})," event on\nthe element:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"md.addEventListener('mount', (ev) => {\n  console.log('mf is mounted');\n  // You can now read default options value for example, or \n  // call `setValue()` with format options other than LaTeX.\n  console.log(ev.target.macros);\n});\n"})}),"\n",(0,o.jsx)(t.h2,{id:"-detachedunmounted",children:"\u2464 Detached/Unmounted"}),"\n",(0,o.jsxs)(t.p,{children:["This stage can be reached if the element is explicitly removed from the DOM,\nfor example with ",(0,o.jsx)(t.code,{children:"ChildNode.remove()"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"This stage is not reached when the page is closed: in that case the element\nis immediately disposed of."}),"\n",(0,o.jsx)(t.p,{children:"Once this stage is reached, the same limitations as in the Constructed stage\napply."}),"\n",(0,o.jsx)(t.p,{children:"Note that the next stage could be either for element to be disposed of\nor to be re-attached."}),"\n",(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.strong,{children:"To be notified when this stage is reached"}),", listen for the ",(0,o.jsx)(t.code,{children:"unmount"})," event on\nthe element:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-javascript",children:"md.addEventListener('unmount')((ev) => {\n  console.log('mf is about to be unmounted');\n  // Last chance to interact with the mathfield\n  console.log(ev.target.getValue('ascii-math'));\n});\n"})})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}function m(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var i=n(6540);const o={},s=i.createContext(o);function a(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);